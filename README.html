<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>ImageMatting 使用手册</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="83a260ba-6a28-440f-b758-7fdf2ec3845e" class="page sans"><header><h1 class="page-title">ImageMatting 使用手册</h1><table class="properties"><tbody><tr class="property-row property-row-created_by"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesCreatedBy"><path d="M13.125,10.0354 C12.5536,9.48588 10.801,8.53125 9.625,7.875 L9.625,7.04112 C9.849,6.71912 10.045,6.37 10.1911,5.98588 C10.5849,5.7435 10.9375,5.28412 10.9375,4.8125 C10.9375,4.35488 10.9323,3.94275 10.4668,3.605 C10.3049,1.5575 9.436,0 7,0 C4.564,0 3.69513,1.5575 3.53325,3.605 C3.06775,3.94275 3.0625,4.35488 3.0625,4.8125 C3.0625,5.28412 3.41513,5.7435 3.80888,5.98588 C3.955,6.37 4.151,6.71912 4.375,7.04112 L4.375,7.875 C3.199,8.53125 1.44638,9.48588 0.875,10.0354 C0.1645,10.7188 0,11.8125 0,14 L14,14 C14,11.8125 13.8364,10.7188 13.125,10.0354 Z"></path></svg></span>Author</th><td><span class="user"><img src="https://lh3.googleusercontent.com/a-/AAuE7mC_ELfuFlBhtQtL-rFWzo2TGXm_UYPOF_vPBuLh=s100" class="icon user-icon"/>shu pengyu</span></td></tr><tr class="property-row property-row-last_edited_time"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesCreatedAt"><path d="M6.98643729,14.0000972 C5.19579566,14.0000972 3.40419152,13.3106896 2.04245843,11.9323606 C-0.681017475,9.21200555 -0.680780251,4.76029539 2.04293482,2.04012507 C4.76664406,-0.68004331 9.22427509,-0.68004331 11.9480135,2.04013479 C13.272481,3.36277455 14,5.1330091 14,6.99552762 C14,8.87640182 13.2721894,10.6285043 11.9480135,11.9509302 C10.5679344,13.3105924 8.77756503,14.0000972 6.98643729,14.0000972 Z M10.2705296,7.00913883 L10.2705296,8.46099754 L10.2705296,8.65543362 L10.076181,8.65543362 L8.6543739,8.65543362 L5.72059514,8.65543362 L5.52619796,8.65543362 L5.52619796,8.46099754 L5.52619796,5.52541044 L5.52619796,3.37946773 L5.52619796,3.18502193 L5.72059514,3.18502193 L7.17253164,3.18502193 L7.36692883,3.18502193 L7.36692883,3.37946773 L7.36692883,6.81467358 L10.076181,6.81467358 L10.2705296,6.81467358 L10.2705296,7.00913883 Z M12.1601539,6.99552762 C12.1601539,5.61697497 11.6190112,4.32597154 10.6393933,3.34769528 C8.63253764,1.34336744 5.35197452,1.34061603 3.34153136,3.33944106 C3.33868273,3.34219247 3.33607716,3.34494388 3.33322852,3.34769528 C1.32397148,5.35459953 1.32372842,8.63641682 3.33322852,10.6433794 C5.34295224,12.6504489 8.62968901,12.6504489 10.6393933,10.6433794 C11.6190112,9.66506426 12.1601539,8.37408027 12.1601539,6.99552762 Z"></path></svg></span>Property</th><td><time>@Jun 25, 2021 5:52 AM</time></td></tr></tbody></table></header><div class="page-body"><blockquote id="fc99debf-7114-4667-be41-a2ec1df6b5be" class="">以下所有运行步骤都需在项目根目录下运行，即 <code>cd ImageMatting</code></blockquote><h1 id="d0fed67b-2370-4a47-916f-d0054e13e11e" class="">1. 模型训练</h1><p id="4708cfb4-ce0b-4b66-87cb-345e5b95b432" class="">文件 <code>train_fcn8s_atonce.py</code>，模型为预训练VGG16+从零训练FCN8s</p><p id="fe70d036-cdfb-4589-90be-ce8771535de6" class="">快速使用说明查看 <code>./train_fcn8s_atonce.py -h</code></p><p id="45f07405-7e6e-4ecb-a790-f703768115b3" class="">参数说明</p><pre id="ba4766dc-5f34-410a-b890-ba1cb2de80a2" class="code"><code># [*]为必须值
[*]-g # 训练使用的 GPU ID
[*]--img # 训练图片数据的路径，需以ImageMatting/dataset/为基准路径的相对路径
[*}--mask # 训练掩码数据的路径，需以ImageMatting/dataset/为基准路径的相对路径
--resume # 模型训练中继文件路径
--max-iteration # 模型最大迭代次数，默认100000
--lr # 学习率，默认1e-10
--weight-decay # 权重衰减，默认0.0005
--momentum # 动量，默认0.99

# Example
./train_fcn8s_atonce.py -g 2 --img=images_data_crop --mask=images_mask</code></pre><ul id="dcd43bff-8a9c-4c91-994c-ff1443c985b0" class="bulleted-list"><li>模型训练的参数文件保存至 <code>ImageMatting/logs/训练开始时间/</code><p id="2fab69c7-7aff-439a-a418-7c875be934f9" class=""><code>config.yaml</code> 中保存输入的参数值</p><p id="a5c93d23-ec5f-4245-af81-9d331bd3f02f" class=""><code>log.csv</code> 中保存模型训练中的验证和测试值</p><pre id="a72d3305-e675-4792-8851-a73af337f310" class="code"><code>[&#x27;epoch&#x27;,
&#x27;iteration&#x27;,
&#x27;train/loss&#x27;,
&#x27;train/acc&#x27;,
&#x27;train/acc_cls&#x27;,
&#x27;train/mean_iu&#x27;,
&#x27;train/fwavacc&#x27;,
&#x27;valid/loss&#x27;,
&#x27;valid/acc&#x27;,
&#x27;valid/acc_cls&#x27;,
&#x27;valid/mean_iu&#x27;,
&#x27;valid/fwavacc&#x27;,
&#x27;elapsed_time&#x27;,]</code></pre><p id="f22dbaa2-46e5-413c-8d95-acb95cebd97d" class=""><code>visualization_viz/iter_number</code> 中保存模型在验证集上的运行结果</p><p id="92a93739-78f7-47af-8ee6-71b5787a702d" class=""><code>ImageMatting/logs/训练开始时间/model_best.pth.tar</code> 为模型文件</p></li></ul><ul id="6d467451-2d75-471d-b3c2-fbacc36161b7" class="bulleted-list"><li>训练模型时，每4k次后使用模型运行验证集，如需改动，修改 <code>train_fcn8s_atonce.py</code> 文件<pre id="60b142ff-c90b-43cb-8c2f-51d4663e2107" class="code"><code># train_fcn8s_atonce.py
line 118: interval_validate=4000,</code></pre></li></ul><blockquote id="349088e8-3125-469d-9a04-0496af811495" class="">训练总epoch数目为：<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mtext>最大迭代数</mtext><mtext>训练数据数</mtext></mfrac></mrow><annotation encoding="application/x-tex">\frac{最大迭代数}{训练数据数}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">训练数据数</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">最大迭代数</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span>﻿</span></span></blockquote><ul id="b82b7b58-f644-47a3-af9b-cde57cb8a11c" class="bulleted-list"><li>模型默认为<strong>2分类</strong>，如需改动，修改 <code>train_fcn8s_atonce.py</code> 文件中的 <code>n_class=2</code> 为相应数值。</li></ul><p id="25bfe7ff-9ad1-4775-a702-7333895210c5" class="">
</p><h1 id="be9c8ecb-097a-4fa6-a3e1-f9fa279fdf5b" class="">2. 数据集格式</h1><p id="297b99d9-6b3e-40ef-b7b5-e8d2f1d5a48a" class="">图片格式默认格式为 <code>.jpg</code> ，如不为默认格式，需要修改 <code>ImageMatting/fcnnet/datasets/voc.py</code> 文件</p><pre id="f5402a7c-9874-42c5-a7c5-d841a3ba6be4" class="code"><code># voc.py
line 86: img_file = osp.join(dataset_dir, img_dir_path, &#x27;%s.jpg&#x27; % did)
# 将上面 jpg 改为新数据级对应格式</code></pre><p id="4386a82d-c499-45a2-aaca-c929b8dda6ef" class="">数据集必须存放在 <code>ImageMatting/dataset</code> 文件夹下，所有图像和掩码数据应分别保存在相应的文件夹中， <code>train.txt</code> 和 <code>val.txt</code> 文件分别对应训练数据和测试数据，其中存有图片无后缀名的名称。</p><p id="b684d80a-9f9f-4107-bff1-bf30009f4cba" class="">
</p><h1 id="d4a4a8ad-9fac-43b6-9201-7c1f297125fa" class="">3. 模型验证</h1><p id="ab091aab-0b8f-4152-b6ea-86faf015733b" class="">文件 <code>evaluate_model.py</code></p><p id="1be1fade-9386-46e2-8849-9e1847515708" class="">推荐将 <code>logs</code> 中训练得到的模型，改名后放入 <code>ImageMatting/models/</code> 下</p><p id="efb79d2f-6100-460c-8672-066e8c64c03b" class="">参数说明</p><pre id="09c125dc-d0a7-44b0-b4c9-77307f687f7b" class="code"><code># [*]为必须值
[*]-g # 验证使用的 GPU ID，默认0
[*]--img # 训练图片数据的路径，需以ImageMatting/dataset/为基准路径的相对路径
[*}--mask # 训练掩码数据的路径，需以ImageMatting/dataset/为基准路径的相对路径
-m # 模型文件路径，默认 models/FCN8s.pth.tar

# Example
./evaluate_model.py -g 2 --img=images_data_crop --mask=images_mask -m models/FCN8s.pth.tar</code></pre><p id="99753551-1b2a-4732-8f18-7e3f2761438b" class="">运行后输出 Accuracy, Accuracy Class, Mean IU, FWAV Accuracy</p><p id="d49226c0-a31c-4c1d-8e26-a689d5ae91cb" class="">验证集中的9张图片实际效果图保存为 <code>ImageMatting/models/viz_evaluate.png</code></p><p id="1c7101de-c036-4ca5-af59-d2abd0e06b76" class="">
</p><h1 id="e6bcfee9-ef0d-4e14-8816-778312b964b3" class="">4. 模型预测</h1><p id="ea6232db-8b19-4c2c-9fa1-85349aa85f94" class="">文件 <code>predict.py</code> </p><p id="53ea5e44-9f6a-425e-b9be-81cfad36b791" class="">参数说明</p><pre id="5342ff48-ab3a-4fa5-9a41-17a3434e94fb" class="code"><code># [*]为必须值
[*]-g # 预测使用的 GPU ID
[*]--f # 预测使用的图像文件路径
-m # 模型文件路径，默认 models/FCN8s.pth.tar
-c # 背景颜色转换，B为蓝色，W为白色
-bg # 背景图片合成，背景图片路径

# Example
# example 转换成白色背景
./predict.py -g 2 -f 文件路径 -c W
# example 转换成指定背景
./predict.py -g 2 -f 文件路径 -bg 背景路径</code></pre><p id="3e2b451a-db96-4477-97b6-bc47e7d9a91b" class="">如 -c 和 -bg 参数都为空，则以 <code>ImageMatting/bg/top9.jpg</code> 为背景图片进行背景合成</p><p id="b2e6b9dd-f91e-4abc-9093-7ccd2fd92e98" class="">转换后的图片保存为 <code>./tmp/图片名_changed.jpg</code>，图片对应的掩码文件为<code>./tmp/图片名_mask.jpg</code></p><p id="f0c410c9-8b04-4f07-9695-aeea300cefbb" class="">图片传入时需做一次 600×800 的大小转换，需使用手机的 3:4 拍照模式，才可进行等比压缩</p><p id="47595892-d160-4ed4-ba75-b2a4823ca160" class="">
</p></div></article></body></html>